<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta id="i18n_pagename" content="common-shareSearch" />
    <script src="../../Scripts/boot.js"></script>
</head>
<body>
    <div style="background-color: #fff; padding-top:5px; padding-left:5px;padding-right:5px;">
        <div id="reportSearchForm" class="layui-form" lay-filter="">
            <div class="layui-form-item">
                <div class="layui-inline">
                    <input class="layui-input" id="keyword" name="keyword" autocomplete="off" data-i18n-placeholder="comm-key-words" placeholder="Key Word">
                </div>
                <div class="layui-btn-group layui-inline">
                    <button class="layui-btn layui-btn-primary" id="onSearch"><i class="fa fa-search"></i> <span data-i18n-text="btn-search">Search</span> </button>
                    <button class="layui-btn layui-btn-primary" id="onClean"><i class="fa fa-eraser"></i> <span data-i18n-text="btn-clean">Clean</span></button>
                    <button class="layui-btn layui-btn-primary" id="onConfirm"><i class="fa fa-check"></i> <span data-i18n-text="btn-confirm">Confirm</span></button>
                    <button class="layui-btn layui-btn-warm" id="onClose"><i class="fa fa-close"></i> <span data-i18n-text="btn-close">Close</span></button>
                </div>
            </div>
            <table id="rptResult" class="layui-hide" lay-filter="rptResult" lay-data="{height:'full-300'}"></table>
        </div>
    </div>

    <script>
        var index = parent.layer.getFrameIndex(window.name);
        var _preVal = '';
        var _sourceType = '';
        var _preCallFun = null;
        var form;
        var _subIndex = -1;

        function SetPreValue(sourceType, preValue,callFun) {
            _sourceType = sourceType;
            _preVal = preValue;
            _preCallFun = callFun;

        layui.use(['table', 'form'], function () {
            var tbl = layui.table;
            form = layui.form;
            var $ = layui.$;

            tbl.render({
                elem: '#rptResult',
                url: '../../Data/svcCommProvider.aspx?method=Get_Shared_ReportList',
                page: true,
                limit:10,
                id: 'mySearchResultGrid',
                cellMinWidth: 40,
                height: 'full-50',
                cols: [[
                    { type: "radio" },
                    { field: "ReportNo", title: 'No', width: 100 },
                    { field: "Name", title: 'Report Name', width: 260 },
                    { field: "ReportStatus", title: 'Status' ,width:100},
                    { field: "ReportType", title: 'Type',width:100 },
                    { field: "DueDate", title: 'ReleaseOn', width: 100 },
                    { field: "BizScope", title: 'BizDesc' },
                    { field: "ReportOwnerName", title: 'Owner', width: 100 }
                ]],
                done: function () {
                    refreshLanguage();

                    $('tbody [data-field="ReportNo"] .layui-table-cell').css('text-align', 'left');
                    $('tbody [data-field="Name"] .layui-table-cell').css('text-align', 'left');
                }
            });
            tbl.on('row(rptResult)', function (obj) {
                My_SetSelectedRowStyle(obj);
            });
            tbl.on('rowDouble(rptResult)', function (obj) {
                getSelectedItems('yes',obj.data);
            });

            $('#onClean').click(function () {
                $('#keyword').val('');
                getSearchAgain();
            });
            $('#onClose').click(function () {
                getSelectedItems('','');
            });
            $('#onSearch').click(function () {
                getSearchAgain();
            });
            $('#onConfirm').click(function () {
                var chkStatus = tbl.checkStatus('mySearchResultGrid');
                if (chkStatus.data.length < 1) {
                    layer.alert("No item selected");
                } else
                    getSelectedItems('yes', '');
            });
            function getSearchAgain() {
                var _key = $('#keyword');
                tbl.reload('mySearchResultGrid', {
                    page: { curr: 1 },
                    where: {
                        keyword: _key.val()
                    }
                });
            }
            function getSelectedItems(isGetVal, data) {
                var _returnData = { sourceType: _sourceType, preValue: _preVal };
                if (isGetVal != null && isGetVal != '') {
                    if (data == null || data == '') {
                        var chkStatus = tbl.checkStatus('mySearchResultGrid');
                        _returnData.data = chkStatus.data;
                    }
                    else
                        _returnData.data = [data];
                }
                else {
                    _returnData.data = '';
                }
                if (_preCallFun != null)
                    _preCallFun(_returnData);
                parent.layer.close(index);
            };
        });

        };

    </script>

</body>
</html>


